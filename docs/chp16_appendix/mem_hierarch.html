<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fundamentals: Memory Hierarchy - High Assurance Rust: Developing Secure and Robust Software</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../landing.html">High Assurance Rust</a></li><li class="chapter-item expanded affix "><a href="../faq.html">Frequently Asked Questions (FAQ)</a></li><li class="chapter-item expanded affix "><a href="../engage.html">Engage with this Book!</a></li><li class="chapter-item expanded affix "><a href="../cfp.html">Sponsor Call for Proposals (CFP)</a></li><li class="chapter-item expanded affix "><a href="../download.html">Download</a></li><li class="chapter-item expanded affix "><a href="../changelog.html">Changelog</a></li><li class="chapter-item expanded affix "><a href="../license.html">License</a></li><li class="chapter-item expanded affix "><li class="part-title">Novice: Systems Security</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../chp1/_index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chp1/why_this_book.html"><strong aria-hidden="true">1.1.</strong> Why this book?</a></li><li class="chapter-item expanded "><a href="../chp1/how_is_this_book_structured.html"><strong aria-hidden="true">1.2.</strong> How is this book structured?</a></li><li class="chapter-item expanded "><a href="../chp1/challenges.html"><strong aria-hidden="true">1.3.</strong> Hands-on Learning</a></li><li class="chapter-item expanded "><a href="../chp1/about_the_team.html"><strong aria-hidden="true">1.4.</strong> About the Team</a></li><li class="chapter-item expanded "><a href="../chp1/_hands_on.html"><strong aria-hidden="true">1.5.</strong> Warmup: Environment Setup</a></li></ol></li><li class="chapter-item expanded "><a href="../chp2/_index.html"><strong aria-hidden="true">2.</strong> Software Assurance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chp2/static_vs_dynamic.html"><strong aria-hidden="true">2.1.</strong> Static vs. Dynamic Tools</a></li><li class="chapter-item expanded "><a href="../chp2/static_assurance_1.html"><strong aria-hidden="true">2.2.</strong> Static Assurance (1/2)</a></li><li class="chapter-item expanded "><a href="../chp2/static_assurance_2.html"><strong aria-hidden="true">2.3.</strong> Static Assurance (2/2)</a></li><li class="chapter-item expanded "><a href="../chp2/dynamic_assurance_1.html"><strong aria-hidden="true">2.4.</strong> Dynamic Assurance (1/3)</a></li><li class="chapter-item expanded "><a href="../chp2/dynamic_assurance_2.html"><strong aria-hidden="true">2.5.</strong> Dynamic Assurance (2/3)</a></li><li class="chapter-item expanded "><a href="../chp2/dynamic_assurance_3.html"><strong aria-hidden="true">2.6.</strong> Dynamic Assurance (3/3)</a></li><li class="chapter-item expanded "><a href="../chp2/limits.html"><strong aria-hidden="true">2.7.</strong> Limitations and Threat Modeling</a></li><li class="chapter-item expanded "><a href="../chp2/cli.html"><strong aria-hidden="true">2.8.</strong> DIY CLI Encryption Tool</a></li><li class="chapter-item expanded "><a href="../chp2/operational_assurance_1.html"><strong aria-hidden="true">2.9.</strong> Operational Assurance (1/2)</a></li><li class="chapter-item expanded "><a href="../chp2/operational_assurance_2.html"><strong aria-hidden="true">2.10.</strong> Operational Assurance (2/2)</a></li><li class="chapter-item expanded "><a href="../chp2/_hands_on.html"><strong aria-hidden="true">2.11.</strong> Challenge: Extend the CLI Tool</a></li></ol></li><li class="chapter-item expanded "><a href="../chp3/_index.html"><strong aria-hidden="true">3.</strong> Rust Zero-Crash Course</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chp3/undef.html"><strong aria-hidden="true">3.1.</strong> On Undefined Behavior</a></li><li class="chapter-item expanded "><a href="../chp3/rust_1_low_data_rep.html"><strong aria-hidden="true">3.2.</strong> Rust: Low-Level Data (1/6)</a></li><li class="chapter-item expanded "><a href="../chp3/rust_2_high_data_rep.html"><strong aria-hidden="true">3.3.</strong> Rust: High-Level Data (2/6)</a></li><li class="chapter-item expanded "><a href="../chp3/rust_3_ctrl_flow.html"><strong aria-hidden="true">3.4.</strong> Rust: Control Flow (3/6)</a></li><li class="chapter-item expanded "><a href="../chp3/rust_4_own_1.html"><strong aria-hidden="true">3.5.</strong> Rust: Ownership Principles (4/6)</a></li><li class="chapter-item expanded "><a href="../chp3/rust_5_own_2.html"><strong aria-hidden="true">3.6.</strong> Rust: Ownership in Practice (5/6)</a></li><li class="chapter-item expanded "><a href="../chp3/rust_6_error.html"><strong aria-hidden="true">3.7.</strong> Rust: Error Handling (6/6)</a></li><li class="chapter-item expanded "><a href="../chp3/modules.html"><strong aria-hidden="true">3.8.</strong> The Module System</a></li><li class="chapter-item expanded "><a href="../chp3/tooling.html"><strong aria-hidden="true">3.9.</strong> Recommended Tooling</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.10.</strong> Rust's Release Cycle</div></li><li class="chapter-item expanded "><a href="../chp3/_hands_on.html"><strong aria-hidden="true">3.11.</strong> Challenge: Port a Program</a></li></ol></li><li class="chapter-item expanded "><a href="../chp4/_index.html"><strong aria-hidden="true">4.</strong> Understanding Memory</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> A Software Perspective</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> An Attacker's Perspective</div></li><li class="chapter-item expanded "><a href="../chp4/safe_rust_PLACEHOLDER.html"><strong aria-hidden="true">4.3.</strong> Rust's Memory Safety Guarantees</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.</strong> Integer Representation Issues</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.</strong> The #![no_std] Attribute</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.6.</strong> Case Study: Real-world Rust CVEs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.7.</strong> Debugging with Mozilla rr</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.8.</strong> Writing an Exploit</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.9.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Advanced Beginner: Core Project</li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Binary Search Tree (BST) Basics</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.</strong> Core BST Operations in Python</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.</strong> Problems Translating to Rust</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.3.</strong> The Importance of Balance</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.4.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Building an Arena Allocator</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Let's Talk Allocators</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> A Stack-Only Arena</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.3.</strong> Index-based Data Structures</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.5.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> A Self-balancing BST</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chp7/traits.html"><strong aria-hidden="true">7.1.</strong> Interface-relevant Traits</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> Scapegoat Trees</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.</strong> Insert</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.4.</strong> Remove</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.5.</strong> Find</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.6.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Digital Twin Testing</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Basic QEMU Internals</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.2.</strong> How Semi-hosting Works</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.3.</strong> CLI REPL Harness</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.4.</strong> Limitations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.5.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.6.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Building Maps and Sets</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Implementing Iterators</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Competent: Validation and Deployment</li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Static Verification</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">11.1.</strong> An Introduction to 1st Order Logic</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.2.</strong> Proving Absence of Panics</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.3.</strong> Deductively Verifying our Arena Allocator</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.4.</strong> Model Checking for unsafe Code</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.5.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.6.</strong> Challenge: Prove a Sorting Algorithm</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Dynamic Testing</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">12.1.</strong> Introduction to Coverage-Guided Fuzzing</div></li><li class="chapter-item expanded "><a href="../chp12/diff_fuzz_PLACEHOLDER.html"><strong aria-hidden="true">12.2.</strong> Building a Differential Fuzzing Harness</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.3.</strong> Using Miri to Detect Undefined Behavior</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.4.</strong> Benchmarking and Optimization</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.5.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.6.</strong> Challenge: Bug-hunting with Fuzzers</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Operational Deployment</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">13.1.</strong> Understanding unsafe (1/3)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.2.</strong> Understanding unsafe (2/3)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.3.</strong> Understanding unsafe (3/3)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.4.</strong> CFFI 101</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.5.</strong> C99 Interoperability</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.6.</strong> Python3 Interoperability</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.7.</strong> Runtime Balance Reconfiguration</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.8.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.9.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> Maximizing Assurance</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">14.1.</strong> Rust Security Research</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.2.</strong> Rust's Limitations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.3.</strong> Best Practices Beyond Rust</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.4.</strong> TODO</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.5.</strong> Challenge: TODO</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Conclusion</li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> Review</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">15.1.</strong> Key Concepts</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.2.</strong> Key Blue-Team Skills</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.3.</strong> Key Red-Team Skills</div></li></ol></li><li class="chapter-item expanded "><a href="../chp16_appendix/_index.html"><strong aria-hidden="true">16.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">16.1.</strong> Setup: Using our Docker Container</div></li><li class="chapter-item expanded "><a href="../chp16_appendix/tools.html"><strong aria-hidden="true">16.2.</strong> Inventory: Tools of the Trade</a></li><li class="chapter-item expanded "><a href="../chp16_appendix/books.html"><strong aria-hidden="true">16.3.</strong> Inventory: Recommended Reading</a></li><li class="chapter-item expanded "><a href="../chp16_appendix/resources.html"><strong aria-hidden="true">16.4.</strong> Inventory: Additional Resources</a></li><li class="chapter-item expanded "><a href="../chp16_appendix/crypto.html"><strong aria-hidden="true">16.5.</strong> Fundamentals: Stream Ciphers</a></li><li class="chapter-item expanded "><a href="../chp16_appendix/types.html"><strong aria-hidden="true">16.6.</strong> Fundamentals: Type Systems</a></li><li class="chapter-item expanded "><a href="../chp16_appendix/components.html"><strong aria-hidden="true">16.7.</strong> Fundamentals: Component-Based Design</a></li><li class="chapter-item expanded "><a href="../chp16_appendix/mem_hierarch.html" class="active"><strong aria-hidden="true">16.8.</strong> Fundamentals: Memory Hierarchy</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.9.</strong> Fundamentals: Dynamic Linking</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.10.</strong> Misc: Size Optimization</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.11.</strong> Misc: The Typestate Pattern</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.12.</strong> Misc: C++ Interoperability</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.13.</strong> Misc: Compile-time Metaprogramming</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">High Assurance Rust: Developing Secure and Robust Software</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/tnballo/high-assurance-rust" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://highassurance.rs/engage.html#submit-feedback-questions-issues-or-prs" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="fundamentals-memory-hierarchy"><a class="header" href="#fundamentals-memory-hierarchy">Fundamentals: Memory Hierarchy</a></h1>
<p>Most programmers aren't aware of the gory details of interacting with the hardware beneath them.
That's by design.
It's the result of a multi-decade software-hardware co-evolution.</p>
<p>Consider the humble <code>print</code> statement.
Last time you printed formatted output to a console, you likely didn't have think about:</p>
<ul>
<li>
<p>Flushing buffers for a character device (OS software &quot;glue&quot; abstraction to vendor-specific hardware).</p>
</li>
<li>
<p>The intricacies of how parity bits work in the Universal Asynchronous Receiver/Transmitter (UART<sup class="footnote-reference"><a href="#UART">1</a></sup>) protocol (encoding for physical transmission medium).</p>
</li>
</ul>
<p>These are minutiae most day-to-day development shouldn't have to factor in.
Memory hardware technology is, likewise, something you'll be largely abstracted from.
Most of the time, you can think of a computer, any computer, as a composite of two distinct parts:</p>
<ol>
<li>
<p>A <strong>Central Processing Unit (CPU)</strong> that fetches, decodes, and executes instructions from compiled binaries.</p>
</li>
<li>
<p>A singular <strong>memory system</strong> holding instructions the CPU reads and data it operates on.</p>
</li>
</ol>
<p>In this simple two part conceptualization, memory is just a linear array of bytes that can be addressed individually and accessed in constant time.
But that's not reality.</p>
<p>What we think of as &quot;memory&quot;, from a software perspective, is actually a heterogeneous mix of hardware technologies that offer varying speeds and capacities at different price points.
And that can have repercussions for systems software.</p>
<p>Decisions you make as a systems programmer can determine what particular kind of storage hardware your program makes use of during its execution.
And this hardware's characteristics can have a <em>significant</em> impact on the speed of your program.
So we need to ground our discussion of memory in its physical reality: the performance hierarchy of contemporary storage technologies.</p>
<blockquote>
<p><strong>Credit where credit is due</strong></p>
<p>The contents of this chapter are heavily influenced by &quot;Computer Systems: A Programmer's Perspective&quot;<sup class="footnote-reference"><a href="#CSAPP">2</a></sup>.</p>
<p>The book's authors, professors at Carnegie Mellon University, use it to teach an undergraduate CS course. The course number is 15-213, affectionately called &quot;the course that gives CMU its zip&quot; because 15213 is the ZIP code in which the university is located and because the course is so foundational in the university's core CS curriculum.</p>
<p>CS:APP is a well-regarded text and a detailed introduction to both computer architecture and operating systems.
Highly recommend it.</p>
</blockquote>
<h2 id="the-memory-performance-hierarchy"><a class="header" href="#the-memory-performance-hierarchy">The Memory Performance Hierarchy</a></h2>
<p>We can arrange modern memory technologies into distinct, hierarchical tiers.</p>
<ul>
<li>
<p>The higher tiers are <strong>incredibly fast</strong> but also <strong>incredibly expensive per byte</strong>. They are a scarce resource. As a consequence, the amount of data they can store is limited.</p>
</li>
<li>
<p>The lower tiers are <strong>relatively slow</strong> but also <strong>relatively cheap per byte</strong>. They're a plentiful resource, we're free to store large amounts of data in them.</p>
</li>
</ul>
<p>Consider this breakdown:</p>
<table><thead><tr><th>Storage Technology</th><th>Unit of Storage</th><th>Access Time (Nanoseconds) <sup class="footnote-reference"><a href="#CornellCompArch">3</a></sup></th><th>Explicit APIs?</th></tr></thead><tbody>
<tr><td>CPU Registers</td><td>4-8 bytes per register</td><td>1 ns</td><td>No</td></tr>
<tr><td>SRAM Cache</td><td>Kilobytes, Megabytes</td><td>1 to 4 ns (L1 to L2<sup class="footnote-reference"><a href="#L1">4</a></sup>)</td><td>No</td></tr>
<tr><td>DRAM</td><td>Gigabytes</td><td>100 ns</td><td>Yes, stack and heap</td></tr>
<tr><td>Local Disk</td><td>Gigabytes, Terabytes</td><td>16,000 to 4,000,000 ns (SSD read to HDD seek<sup class="footnote-reference"><a href="#SSD">5</a></sup>)</td><td>Yes, unless DRAM exhausted (swap)</td></tr>
<tr><td>Remote Storage</td><td><em>N/A, Unlimited</em></td><td>15,0000,000 ns (Packet RTT<sup class="footnote-reference"><a href="#RTT">6</a></sup> California to/from Netherlands)</td><td>Yes, networking</td></tr>
</tbody></table>
<ul>
<li>
<p><strong>CPU Registers:</strong> Accessed directly when instructions execute (e.g. in 0 CPU cycles<sup class="footnote-reference"><a href="#CSAPP">2</a></sup>), registers sit at the top of the hierarchy.</p>
<ul>
<li>Register allocation is handled by the compiler, in accordance with a target machine's Application Binary Interface (ABI)<sup class="footnote-reference"><a href="#ABI">7</a></sup>. Unless you're writing inline assembly<sup class="footnote-reference"><a href="#InAsm">8</a></sup> (intermixing architecture-specific instructions with Rust source code), you won't control register usage directly.</li>
</ul>
</li>
<li>
<p><strong>SRAM Cache:</strong> A small memory bank built into the CPU, physically close to the register action. Accessible in 4 to 75 CPU cycles<sup class="footnote-reference"><a href="#CSAPP">2</a></sup>.</p>
<ul>
<li>How often data your code needs will be present in the cache (aka &quot;cache hit ratio&quot;) is a side effect of how your code is written, but not something you can explicitly control with API calls. Data-oriented Programming<sup class="footnote-reference"><a href="#DataRust">9</a></sup> deals with structuring programs to make optimal use of CPU caches.</li>
</ul>
</li>
<li>
<p><strong>DRAM:</strong> Main memory, the sweet spot for most systems programming. Accessible in hundreds of cycles<sup class="footnote-reference"><a href="#CSAPP">2</a></sup>.</p>
<ul>
<li>Often, we can explicitly control which regions of main memory we use. Specifically whether data is stored on the stack, the heap, static memory, or even &quot;memory-mapped&quot; files - among other locations. Each option has performance implications. You already wrote a stack-only program: the RC4 implementation in the Chapter 2 specified the <code>#![no_std]</code> attribute.</li>
</ul>
</li>
<li>
<p><strong>Local Disk:</strong> Long-term storage that persists across runs of a program or reboots of a machine. Accessible in tens of millions of cycles<sup class="footnote-reference"><a href="#CSAPP">2</a></sup>, a significant penalty relative to the levels above.</p>
<ul>
<li>Interacting with local disk storage typically means calling explicit APIs to open, read, or write files. Unless all available DRAM is currently in use - in which case the OS is forced to <em>page</em><sup class="footnote-reference"><a href="#Paging">10</a></sup> your program data to/from local secondary storage behind-the-scenes.</li>
</ul>
</li>
<li>
<p><strong>Remote Disk:</strong> Long-term storage on a physically separate machine, connected to the host running your program via a network. Access latency can't even be measured in CPU cycles, there are too many unpredictable factors at play (protocols, physical distance, network congestion, etc). The above table uses nanosecond estimates<sup class="footnote-reference"><a href="#CornellCompArch">3</a></sup> for your convenience.</p>
<ul>
<li>There's no way to implicitly download/upload data from/to a remote machine, you must call a networking API directly or indirectly.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Memory Management in Modern Operating Systems</strong></p>
<p>Paging schemes<sup class="footnote-reference"><a href="#Paging">10</a></sup> are a part of how <em>virtual memory</em> (an abstraction for DRAM managed by the OS) is implemented.
This is a complex topic with many implications, I'd recommend Chapter 9 of CS:APP<sup class="footnote-reference"><a href="#CSAPP">2</a></sup> for a thorough exploration.
To summarize, we can think of virtual memory as providing three benefits:</p>
<ul>
<li>
<p><strong>Simplified view of memory:</strong> Each process is given an uniform linear virtual address space to run in, regardless of where it's actually mapped in physical memory and whether or not some of those mappings are shared with another process.</p>
</li>
<li>
<p><strong>Address space isolation:</strong> The OS can enforce isolation between the address spaces of each process, preventing one process from corrupting another. Likewise userspace applications (e.g. your program) can't access kernel space (e.g. OS internals).</p>
</li>
<li>
<p><strong>Efficiency through caching:</strong> Allows main memory (system DRAM) to act as a cache for files on disk, making active items more quickly accessible and managing the back-and-forth transfer between DRAM and disk (paging). The smallest unit of data an OS can move is 1 page (typically 4 kB).</p>
</li>
</ul>
</blockquote>
<h2 id="ok-but-what-are-the-practical-implications-of-all-this"><a class="header" href="#ok-but-what-are-the-practical-implications-of-all-this">Ok, but what are the practical implications of all this?</a></h2>
<p>Distinct types of memory hardware have a significant impact on performance.
Potentially orders of magnitude.
So, assuming we've picked the <em>fastest known algorithm</em>, we should keep two facts in mind:</p>
<ul>
<li>
<p><strong>Disk and/or network I/O is expensive but explicit.</strong> The bottom two rungs of the memory performance hierarchy are far slower, but at least we can consciously control their usage.</p>
<ul>
<li>In addition to being slow, file and network I/O are <em>fallible</em>. A file might have moved or changed permissions. A remote server may become temporarily or permanently inaccessible. Logic for handling these cases, whether it be propagating an error or retrying an alternate path/host, further exacerbates performance cost.</li>
</ul>
</li>
<li>
<p><strong>Cache optimization can be a differentiator.</strong> Rust's <code>BTreeSet</code><sup class="footnote-reference"><a href="#BTreeSet">11</a></sup> and <code>BTreeMap</code><sup class="footnote-reference"><a href="#BTreeMap">12</a></sup>, the standard library collections we'll build alternatives to, are specifically designed to maximize SRAM cache efficiency. Both are very performant.</p>
<ul>
<li>
<p>As an aside, the standard libraries of C++ and Java both use Red-Black Trees. B-trees are more common in filesystem and database use cases.</p>
</li>
<li>
<p>Our library's optimizations target another level of the hierarchy: DRAM. Using an index-based allocator pattern (introduced in Chapter 6), we'll ensure our code only uses <em>stack</em> DRAM. The result is embedded portability.</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Why the &quot;fastest known algorithm&quot; caveat?</strong></p>
<p>Algorithms typically have a much greater performance impact than the kind of physical memory backing execution.</p>
<p>If you implement a quadratic time solution when a problem can be solved in linear time, no amount of SRAM locality can compensate.
The latter solution scales far, far better regardless.</p>
<p>We discuss the basics of algorithmic complexity in Chapter 7.</p>
</blockquote>
<h2 id="takeaway"><a class="header" href="#takeaway">Takeaway</a></h2>
<p>Much as we'd like to believe memory is just a linear array of bytes, the reality is it's a hierarchy of hardware making cost/performance tradeoffs.
This physical view of memory is foundational.</p>
<p>But day-to-day systems programming is more concerned with a logical view of memory, namely managing stack frames and heap buffers.
Stored in DRAM.
That's the abstraction through which we view all code in this book.</p>
<hr />
<div class="footnote-definition" id="UART"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.circuitbasics.com/basics-uart-communication/"><em>Basics of UART Communication</em></a>. Scott Campbell (Accessed 2022).</p>
</div>
<div class="footnote-definition" id="CSAPP"><sup class="footnote-definition-label">2</sup>
<p><a href="https://amzn.to/3IBnFA7"><em><strong>[PERSONAL FAVORITE]</strong> Computer Systems: A Programmer's Perspective</em></a>. Randal Bryant, David O'Hallaron (2015).</p>
</div>
<div class="footnote-definition" id="CornellCompArch"><sup class="footnote-definition-label">3</sup>
<p><a href="https://people.orie.cornell.edu/bdg79/ORIE6125/lecture8.html"><em>ORIE 6125: Week 8 - Computer architecture</em></a>. Cornell University (Accessed 2022).</p>
</div>
<div class="footnote-definition" id="ABI"><sup class="footnote-definition-label">7</sup>
<p><a href="https://en.wikipedia.org/wiki/Application_binary_interface">Application binary interface</a>. Wikipedia (Accessed 2022).</p>
</div>
<div class="footnote-definition" id="L1"><sup class="footnote-definition-label">4</sup>
<p><a href="https://en.wikipedia.org/wiki/CPU_cache#MULTILEVEL">Multi-level caches</a>. Wikipedia (Accessed 2022).</p>
</div>
<div class="footnote-definition" id="SSD"><sup class="footnote-definition-label">5</sup>
<p>Solid State Drives (SSDs) and Hard Disk Drives (HDDs) are two secondary storage technologies. The former offers faster read and write speeds.</p>
</div>
<div class="footnote-definition" id="RTT"><sup class="footnote-definition-label">6</sup>
<p>Round Trip Time (RTT), in this context, is the amount of time it takes for a packet to reach a destination and for an acknowledgment to come back.</p>
</div>
<div class="footnote-definition" id="InAsm"><sup class="footnote-definition-label">8</sup>
<p><a href="https://blog.rust-lang.org/inside-rust/2020/06/08/new-inline-asm.html"><em>New inline assembly syntax available in nightly</em></a>. Josh Triplett (2020).</p>
</div>
<div class="footnote-definition" id="DataRust"><sup class="footnote-definition-label">9</sup>
<p><a href="http://jamesmcm.github.io/blog/2020/07/25/intro-dod/"><em>An introduction to Data Oriented Design with Rust</em></a>. James McMurray (2020).</p>
</div>
<div class="footnote-definition" id="Paging"><sup class="footnote-definition-label">10</sup>
<p><a href="https://wiki.osdev.org/Paging">Paging</a>. OSDev Wiki (Accessed 2022).</p>
</div>
<div class="footnote-definition" id="BTreeSet"><sup class="footnote-definition-label">11</sup>
<p><a href="https://doc.rust-lang.org/stable/std/collections/struct.BTreeSet.html"><em>Struct <code>std::collections::BTreeSet</code></em></a>. The Rust Team (Accessed 2022).</p>
</div>
<div class="footnote-definition" id="BTreeMap"><sup class="footnote-definition-label">12</sup>
<p><a href="https://doc.rust-lang.org/std/collections/struct.BTreeMap.html"><em>Struct <code>std::collections::BTreeMap</code></em></a>. The Rust Team (Accessed 2022).</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chp16_appendix/components.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chp16_appendix/components.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
